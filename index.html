<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>AI Programming Helper — Multi API</title>
<style>
    body {
        font-family: Arial, sans-serif;
        background: #f4f4f4;
        margin: 0;
        padding: 0;
    }
    .container {
        max-width: 900px;
        margin: auto;
        background: white;
        padding: 20px;
        border-radius: 8px;
        margin-top: 20px;
    }
    h1 { text-align: center; }
    .apis {
        display: flex;
        gap: 10px;
        flex-wrap: wrap;
        margin-bottom: 10px;
    }
    .api-option {
        background: #ddd;
        padding: 10px;
        cursor: grab;
        border-radius: 4px;
        user-select: none;
    }
    .api-option.dragging {
        opacity: 0.5;
    }
    input, button {
        width: 100%;
        padding: 10px;
        margin: 10px 0;
        font-size: 16px;
    }
    button {
        background: #28a745;
        color: white;
        border: none;
        cursor: pointer;
    }
    pre {
        background: #222;
        color: #0f0;
        padding: 10px;
        overflow-x: auto;
    }
    .mermaid {
        background: #f0f0f0;
        padding: 10px;
        border-radius: 8px;
    }
</style>
<script src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"></script>
<script>mermaid.initialize({ startOnLoad: false });</script>
</head>
<body>

<div class="container">
    <h1>AI Programming Helper — Multi API</h1>

    <h3>Drag & Drop APIs to set the call order:</h3>
    <div id="api-list" class="apis">
        <div class="api-option" draggable="true" data-api="stackexchange">StackOverflow</div>
        <div class="api-option" draggable="true" data-api="github">GitHub Code Search</div>
        <div class="api-option" draggable="true" data-api="dictionary">Dictionary</div>
        <div class="api-option" draggable="true" data-api="wikipedia">Wikipedia</div>
        <div class="api-option" draggable="true" data-api="programmingQuotes">Programming Quotes</div>
    </div>

    <input type="text" id="question" placeholder="Ask your programming question...">
    <button id="ask-btn">Ask All APIs</button>

    <h3>API Responses:</h3>
    <pre id="response"></pre>

    <h3>Flowchart:</h3>
    <div class="mermaid" id="flowchart"></div>
</div>

<script>
// ================= DRAG & DROP SORTING =================
const apiList = document.getElementById("api-list");
let dragged = null;
apiList.addEventListener("dragstart", e => {
    dragged = e.target;
    e.target.classList.add("dragging");
});
apiList.addEventListener("dragend", e => {
    e.target.classList.remove("dragging");
});
apiList.addEventListener("dragover", e => {
    e.preventDefault();
    const afterElement = getDragAfterElement(apiList, e.clientX);
    if (afterElement == null) {
        apiList.appendChild(dragged);
    } else {
        apiList.insertBefore(dragged, afterElement);
    }
});
function getDragAfterElement(container, x) {
    const draggableElements = [...container.querySelectorAll(".api-option:not(.dragging)")];
    return draggableElements.reduce((closest, child) => {
        const box = child.getBoundingClientRect();
        const offset = x - box.left - box.width / 2;
        if (offset < 0 && offset > closest.offset) {
            return { offset: offset, element: child };
        } else {
            return closest;
        }
    }, { offset: Number.NEGATIVE_INFINITY }).element;
}

// ================= API CALLS =================
async function callAPI(api, query) {
    try {
        if (api === "stackexchange") {
            let res = await fetch(`https://api.stackexchange.com/2.3/search?order=desc&sort=relevance&intitle=${encodeURIComponent(query)}&site=stackoverflow`);
            let data = await res.json();
            return data.items?.[0] ? `${data.items[0].title} → ${data.items[0].link}` : "No StackOverflow result";
        }
        if (api === "github") {
            let res = await fetch(`https://api.github.com/search/code?q=${encodeURIComponent(query)}+in:file+language:javascript`);
            let data = await res.json();
            return data.items?.[0]?.html_url || "No GitHub result";
        }
        if (api === "dictionary") {
            let res = await fetch(`https://api.dictionaryapi.dev/api/v2/entries/en/${encodeURIComponent(query)}`);
            let data = await res.json();
            return data[0]?.meanings?.[0]?.definitions?.[0]?.definition || "No dictionary definition";
        }
        if (api === "wikipedia") {
            let res = await fetch(`https://en.wikipedia.org/api/rest_v1/page/summary/${encodeURIComponent(query)}`);
            let data = await res.json();
            return data.extract || "No Wikipedia info";
        }
        if (api === "programmingQuotes") {
            let res = await fetch("https://programming-quotes-api.herokuapp.com/quotes/random");
            let data = await res.json();
            return `"${data.en}" — ${data.author}`;
        }
    } catch (err) {
        return `${api} API Error`;
    }
    return "Unknown API";
}

// ================= ASK BUTTON =================
document.getElementById("ask-btn").addEventListener("click", async () => {
    const query = document.getElementById("question").value.trim();
    if (!query) return alert("Please enter a question");

    const apis = [...document.querySelectorAll(".api-option")].map(el => el.dataset.api);
    let responses = [];

    for (let api of apis) {
        let answer = await callAPI(api, query);
        responses.push({ api, answer });
    }

    document.getElementById("response").textContent =
        responses.map(r => `[${r.api.toUpperCase()}] ${r.answer}`).join("\n\n");

    // ================= FLOWCHART =================
    let chart = "graph TD;\n";
    chart += `Q[Question: ${query}];\n`;
    responses.forEach((r, i) => {
        let safeAnswer = r.answer.replace(/[\[\]]/g, '').replace(/\"/g, "'");
        chart += `Q --> A${i}[${r.api.toUpperCase()}: ${safeAnswer}];\n`;
    });
    document.getElementById("flowchart").textContent = chart;
    mermaid.init(undefined, document.querySelectorAll("#flowchart"));
});
</script>

</body>
</html>
